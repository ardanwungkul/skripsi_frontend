import{n as B,k as d,l as T,o as S,a as l,b as V,w as $,d as s,h as i,p as v,F as _,y,z as F,N as K,m as N,j as x,S as R,t as g,K as j,u as z,aX as E}from"./index-638c9339.js";import{P as H}from"./pusher-a6179d9a.js";import{_ as P}from"./SupportLayout-543b7b85.js";import{u as A}from"./user-63e47d30.js";const L={class:"w-full flex gap-3"},X={class:"w-full max-w-xs bg-light-primary-1 dark:bg-dark-primary-2 rounded-lg shadow-lg p-5"},q=["value","id"],G=["for"],I={class:"p-3 h-full w-full bg-light-primary-1 dark:bg-dark-primary-2 rounded-lg shadow-lg space-y-2"},J={class:"flex gap-1"},O={class:"text-[10px] text-gray-200 ml-3 self-end"},Q={key:0,class:"w-full"},W={class:"flex items-center w-full gap-3"},Y=s("i",{class:"fa-solid fa-paper-plane-top"},null,-1),Z=[Y],re={__name:"Chatbox",setup(ee){const r=B(),f=A(),o=d(),c=d([]),h=d([]),n=d(""),u=d(null);var w=new H("511534a0c376ec5d7819",{cluster:"mt1"}),b=w.subscribe("chat");b.bind("App\\Events\\MessageSent",function(e){e.message.sender_id!==r.userData.id&&c.value.push(e.message)});const m=()=>{const e=new FormData;e.append("message",n.value),e.append("sender_id",r.userData.id),e.append("receiver_id",o.value.id),n.value.trim()!==""&&x.post("/api/messages/user/",e).then(t=>{c.value.push(t.data),n.value=""})},k=()=>{E(()=>{u.value&&(u.value.scrollTop=u.value.scrollHeight)})},D=e=>{const t=new Date(e);return`${t.getHours()}:${t.getMinutes()}`};T(()=>{r.hasUserData||r.getData()});const U=async()=>{x.get(`/api/messages/user/${o.value.id}`).then(e=>{c.value=e.data,k()})};S(async()=>{await f.getData(),M()});async function M(){h.value=f.users.filter(e=>e.role=="user")}return(e,t)=>(l(),V(P,{title:"Chat"},{default:$(()=>[s("div",L,[s("div",X,[(l(!0),i(_,null,v(h.value,(a,p)=>(l(),i("div",{key:p,class:"w-full"},[y(s("input",{class:"peer hidden",type:"radio",onChange:U,name:"selectedUser","onUpdate:modelValue":t[0]||(t[0]=C=>o.value=C),value:a,id:"selectUser"+a.id},null,40,q),[[R,o.value]]),s("label",{for:"selectUser"+a.id,class:"border-y p-3 w-full block peer-checked:bg-gray-100 dark:peer-checked:bg-dark-primary-1 rounded-lg dark:text-white"},g(a.name),9,G)]))),128))]),s("div",I,[s("div",{class:"chat-messages flex flex-col items-start gap-1 p-4 overflow-y-scroll h-[70vh] invisible-scrollbar",ref_key:"chatMessagesRef",ref:u},[(l(!0),i(_,null,v(c.value,(a,p)=>(l(),i("div",{key:p,class:j([z(r).userData.id==a.sender_id?"text-start self-end bg-[#005c4b]":"text-end self-start bg-[#353535]","text-white px-3 py-2 rounded-lg max-w-2xl"])},[s("div",J,[s("p",null,g(a.text),1),s("span",O,g(D(a.created_at)),1)])],2))),128))],512),o.value?(l(),i("div",Q,[s("div",W,[y(s("input",{class:"w-full rounded-lg bg-gray-200 dark:bg-dark-primary-1 dark:text-typography-1 shadow-lg","onUpdate:modelValue":t[1]||(t[1]=a=>n.value=a),onKeyup:K(m,["enter"]),placeholder:"Type a message..."},null,544),[[F,n.value]]),s("button",{onClick:m,class:"p-3 rounded-lg break-words flex items-center justify-center bg-[#005c4b] text-typography-1 h-full"},Z)])])):N("",!0)])])]),_:1}))}};export{re as default};
